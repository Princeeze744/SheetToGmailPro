<!DOCTYPE html>
<html>
<head>
    <title>SheetToGmail Web</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>SheetToGmail Web</h1>

        <form id="configForm">
            <div class="mb-3">
                <label class="form-label">Spreadsheet ID</label>
                <input type="text" class="form-control" name="spreadsheet_id" value="{{ config.spreadsheet_id }}">
            </div>
            <div class="mb-3">
                <label class="form-label">Worksheet Name</label>
                <input type="text" class="form-control" name="worksheet_name" value="{{ config.worksheet_name }}">
            </div>
            <div class="mb-3">
                <label class="form-label">Sender Email</label>
                <input type="email" class="form-control" name="sender_email" value="{{ config.sender_email }}">
            </div>
            <div class="mb-3">
                <label class="form-label">Gmail App Password</label>
                <input type="password" class="form-control" name="gmail_app_password" value="{{ config.gmail_app_password }}">
            </div>
            <div class="mb-3">
                <label class="form-label">Recipient Email</label>
                <input type="email" class="form-control" name="recipient_email" value="{{ config.recipient_email }}">
            </div>
            <div class="mb-3">
                <label class="form-label">Poll Interval (seconds)</label>
                <input type="number" class="form-control" name="poll_interval" value="{{ config.poll_interval }}">
            </div>
            <button type="submit" class="btn btn-primary">Save Configuration</button>
        </form>

        <hr>

        <button id="toggleMonitoring" class="btn {% if monitoring %}btn-danger{% else %}btn-success{% endif %}">
            {% if monitoring %}Stop Monitoring{% else %}Start Monitoring{% endif %}
        </button>

        <div id="status" class="mt-3"></div>
    </div>

    <script>
        document.getElementById('configForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch('/update_config', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('status').innerHTML = '<div class="alert alert-success">Configuration saved!</div>';
            })
            .catch(error => {
                document.getElementById('status').innerHTML = '<div class="alert alert-danger">Error saving configuration.</div>';
            });
        });

        document.getElementById('toggleMonitoring').addEventListener('click', function() {
            fetch('/toggle_monitoring', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'started') {
                    this.classList.remove('btn-success');
                    this.classList.add('btn-danger');
                    this.textContent = 'Stop Monitoring';
                    document.getElementById('status').innerHTML = '<div class="alert alert-success">Monitoring started!</div>';
                } else {
                    this.classList.remove('btn-danger');
                    this.classList.add('btn-success');
                    this.textContent = 'Start Monitoring';
                    document.getElementById('status').innerHTML = '<div class="alert alert-info">Monitoring stopped.</div>';
                }
            });
        });
    </script>
</body>
</html>